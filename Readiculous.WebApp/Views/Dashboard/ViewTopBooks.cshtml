@model List<Readiculous.Services.ServiceModels.BookListItemViewModel>

@{
    Layout = "_Layout";
    ViewData["Title"] = "Top Books";

    var validBooks = Model?
        .Where(b => !string.IsNullOrWhiteSpace(b.Title))
        .OrderByDescending(b => b.AverageRating)
        .ToList() ?? new List<Readiculous.Services.ServiceModels.BookListItemViewModel>();
}

<section class="container py-4">

    <!-- Search bar with result container -->
    <div class="position-relative mb-5">
        <input type="text"
               class="form-control"
               id="bookSearchTopBooks"
               placeholder="🔍 Book Search..."
               autocomplete="off" />
        <div id="searchResultsTopBooks"
             class="list-group position-absolute"
             style="z-index: 999; width: 100%; display: none;"></div>
    </div>

    <h2 class="section-title mb-4 text-center">TOP BOOKS</h2>

    @if (validBooks.Any())
    {
        <!-- Top Row (First 5 Books) -->
        <div class="book-wrapper p-4 mb-4">
            <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-5 g-4">
                @foreach (var book in validBooks.Take(5))
                {
                    <div class="col">
                        <a href="@Url.Action("BookDetailScreen", "Dashboard", new { id = book.BookId })" class="text-decoration-none text-reset">
                            <div class="card book-card h-100 text-center">
                                <img src="@(string.IsNullOrEmpty(book.CoverImageUrl) ? "/img/placeholder.png" : book.CoverImageUrl)" class="card-img-top book-image" alt="@book.Title" />
                                <div class="card-body">
                                    <h6 class="card-title">@book.Title</h6>
                                    <p class="card-author small text-muted">@book.Author</p>
                                    <p class="card-rating text-warning mb-0">⭐ @book.AverageRating</p>
                                </div>
                            </div>
                        </a>
                    </div>
                }
            </div>
        </div>

        <!-- Bottom Row (Next 5 Books) -->
        @if (validBooks.Count > 5)
        {
            <div class="book-wrapper p-4">
                <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-5 g-4">
                    @foreach (var book in validBooks.Skip(5).Take(5))
                    {
                        <div class="col">
                            <a href="@Url.Action("BookDetailScreen", "Dashboard", new { id = book.BookId })" class="text-decoration-none text-reset">
                                <div class="card book-card h-100 text-center">
                                    <img src="@(string.IsNullOrEmpty(book.CoverImageUrl) ? "/img/placeholder.png" : book.CoverImageUrl)" class="card-img-top book-image" alt="@book.Title" />
                                    <div class="card-body">
                                        <h6 class="card-title">@book.Title</h6>
                                        <p class="card-author small text-muted">@book.Author</p>
                                        <p class="card-rating text-warning mb-0">⭐ @book.AverageRating</p>
                                    </div>
                                </div>
                            </a>
                        </div>
                    }
                </div>
            </div>
        }
    }
    else
    {
        <div class="alert alert-warning text-center">
            No top books found.
        </div>
    }

    <!-- Hidden JSON for search -->
    <input type="hidden" id="booksJsonTopBooks" value='@Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(
        validBooks.Select(b => new {
            id = b.BookId,
            title = b.Title.Trim(),
            cover = string.IsNullOrEmpty(b.CoverImageUrl) ? "/img/placeholder.png" : b.CoverImageUrl
        })
    ))' />

    <!-- Pagination (Placeholder) -->
    <div class="mt-5 d-flex justify-content-center">
        <nav aria-label="Page navigation">
            <ul class="pagination pagination-rounded">
                <li class="page-item disabled"><a class="page-link" href="#">«</a></li>
                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                <li class="page-item"><a class="page-link" href="#">2</a></li>
                <li class="page-item"><a class="page-link" href="#">3</a></li>
                <li class="page-item"><a class="page-link" href="#">»</a></li>
            </ul>
        </nav>
    </div>

</section>

<style>
    .body {
        background-color: #f6f1f4;
    }

    .section-title {
        font-weight: bold;
        color: #3d2c40;
        border-bottom: 2px solid #b089a5;
        display: inline-block;
        padding-bottom: 6px;
    }

    .book-wrapper {
        background-color: #fff;
        border: 1px solid #ecd6e0;
        border-radius: 12px;
        box-shadow: 0 3px 10px rgba(0,0,0,0.08);
    }

    .book-card {
        border: 1px solid #ecd6e0;
        border-radius: 12px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

        .book-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
        }

    .book-image {
        height: 220px;
        object-fit: cover;
        border-radius: 12px 12px 0 0;
    }

    .card-title {
        font-size: 0.95rem;
        font-weight: 600;
        color: #3d2c40;
    }

    .card-author {
        font-size: 0.85rem;
    }

    .pagination .page-link {
        color: #b089a5;
        border: 1px solid #ecd6e0;
        border-radius: 8px;
        padding: 6px 12px;
    }

    .pagination .page-item.active .page-link {
        background-color: #b089a5;
        color: white;
        border: none;
    }

    .pagination .page-link:hover {
        background-color: #edaec0;
        color: white;
    }

    #searchResultsTopBooks {
        max-height: 300px;
        overflow-y: auto;
    }

        #searchResultsTopBooks .list-group-item {
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        #searchResultsTopBooks img {
            width: 40px;
            height: 60px;
            object-fit: cover;
            margin-right: 10px;
            border-radius: 4px;
        }
</style>

@section Scripts {
    <script src="~/js/topBook.js"></script>
}
